# REFERENCES
- [chunk](https://masteringllm.medium.com/11-chunking-strategies-for-rag-simplified-visualized-df0dbec8e373)

## chunk

检索增强生成（RAG）将预训练语言模型与信息检索系统结合，以产生更准确且符合上下文的回答。通过从外部文档获取相关信息，RAG 增强了模型处理超出训练数据查询的能力。

RAG 的一个关键组成部分是分块过程 ，即将大型文档分割成更小、更易管理的部分，称为“ 块 ”。这些区块随后被索引，并在检索阶段使用，为语言模型提供上下文相关信息。

为什么分块很重要,分块在 RAG 中有多重用途：

- 效率： 更小的块减少检索时的计算开销。
- 相关性 ：精确的片段能提高获取相关信息的可能性。
- 上下文保持 ：适当的分块维护信息完整性，确保回答连贯。

然而，不适当的分块可能导致：
- 语境丧失 ：在任意点断开信息可能会破坏意义。
- 冗余性：重叠的块可能会引入重复的信息。
- 不一致 ：块大小可变会使检索和索引变得复杂。

### 分块策略概述
分块策略因文本划分方式和所保留的上下文程度而异。主要策略包括：

- Fixed-Length Chunking  固定长度分块
- Sentence-Based Chunking  基于句子的分块
- Paragraph-Based Chunking  基于段落的分块
- Sliding Window Chunking  滑动窗口分块
- Semantic Chunking  语义分块
- Recursive Chunking  递归分块
- Context-Enriched Chunking 上下文丰富分块
- Modality-Specific Chunking 模态特定分块
- Agentic Chunking  能动分块
- Subdocument Chunking  子文档分块
- Hybrid Chunking  混合分块
- 
每种方法都有独特的优势，并适合特定的应用场景。让我们详细了解每种分块方法， 比较不同的分块策略，如何选择合适的分块策略 ，并了解在 RAG 中实现分块的最佳实践 。

### 分块方法的详细探索
#### Fixed-Length Chunking  固定长度分块
**工作原理** ：将文本分割成预设长度的块，通常基于标记或字符。

![固定长度分块——可视化](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EQB2VpBvU46F_CJAKwo_tg.png)

**最佳用途** ：简单文档、常见问题，或处理速度优先时。

**优势** ：
- 简洁 ：易于实现，无需复杂算法。
- 一致性 ：产生一致的块大小，简化索引。

**挑战** ：
- 上下文丢失 ：可能使句子或想法分裂，导致信息不完整。
- 相关性问题 ：关键信息可能跨越多个区块，降低检索效率。

**实施建议** ：

- 选择一个能兼顾上下文和效率的适当区块大小。
- 考虑与重叠窗口结合使用，以减少上下文丢失。


#### Sentence-Based Chunking  基于句子的分块

**工作原理** ：在句子边界处分割文本，确保每个段落都是完整的思想。

![基于句子的分块——可视化](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u-SrrW0hu9NP9ymoMKLdCA.png)

**最佳用途** ：简短直接的回答，如客户提问或对话式 AI。

**优势** ：

- 上下文保持 ：保持单个句子的完整性。
- 易于实现 ：利用自然语言处理（NLP）工具进行句子检测。

**挑战** ：

- 上下文有限 ：单句可能缺乏复杂查询所需的足够上下文。
- 可变长度 ：句子长度可能变化，导致段落大小不一致。

**实施建议** ：

- 使用自然语言处理库来准确检测句子边界。
- 如果多句话较短，可以组合起来，形成更完整的段落。


#### Paragraph-Based Chunking  基于段落的分块

**工作原理** ：将文档拆分成段落，通常涵盖完整的观点或主题。

![基于段落的分块——可视化](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kLQWeyqkdpS-piPsZSTckA.png)

**最佳用途** ：结构化文档，如文章、报告或论文。

**Advantages**:  优势 ：

- 更丰富的上下文 ：提供比基于句子的段落更多的信息。
- 逻辑划分 ：与文本的自然结构保持一致。

**挑战** ：

- 长度不一致 ：段落长度差异很大。
- 代币限制 ：较长段落可能超过模型的代币限制。

**实施建议** ：

- 监控区块大小，确保其在可接受的令牌限制范围内。
- 如有必要，在保持上下文的同时，将较长段落进一步拆分。


## Sliding Window Chunking  滑动窗口分块

**工作原理** ：通过在文本上滑动窗口创建重叠区块，确保相邻区块共享内容。


![滑动窗口分块——可视化](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g5bh2vlrStwWQ6rNSKWUDg.png)

**最佳用途** ：在不同章节之间保持上下文至关重要的文档，如法律或医学文本。

**优势** ：
- 上下文连续性：重叠有助于保持信息的流通。
- 改进检索： 提高相关信息被检索到的块中的可能性。

**挑战** ：

- 冗余 ：内容重叠可能导致信息重复。
- 计算成本 ：更多区块意味着处理和存储需求增加。

**实施建议** ：

- 根据文档的性质优化窗口大小和重叠。
- 检索时使用重复去重技术处理冗余。

#### 语义分块

**工作原理** ：利用嵌入或机器学习模型根据语义意义拆分文本，确保每个段落在主题或思想上连贯。

![语义分块——可视化](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FT_qyv2LyGd1b0G-NdBqWQ.png)

**最佳用途** ：需要深入理解的复杂查询，如技术手册或学术论文。

**优势** ：

- 上下文相关性：区块被有意义地分组，提高检索准确性。
- 灵活性 ：适应文本固有的结构和内容。

**Challenges**:  挑战 ：

- 复杂性 ：需要先进的自然语言处理模型和计算资源。
- 处理时间 ：语义分析可能耗时。

**实施建议** ：

- 利用预训练模型进行语义分割。
- 在计算成本与语义块粒度之间的平衡。

#### Recursive Chunking  递归分块

**工作原理** ：通过层级分隔符如标题、副标题、段落和句子，逐步将文本拆分成更小的部分。

![递归分块——可视化](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vsID2Fu4cF2opjJ7WGp1MA.png)

**最佳用途** ：大型、层级结构化的文档，如书籍或详尽报告。

**优势** ：

- 层级上下文 ：维护文档的结构关系。
- 可扩展性：适用于非常庞大的文本。

**挑战** ：

- 复杂实现 ：需要处理多层文本结构。
- 潜在的上下文丢失 ：最小的块如果管理不当，仍然可能丢失上下文。

**实施建议** ：

- 使用文档结构（如 HTML 标签）来识别层级。
- 存储每个块在层级结构中的位置元数据，以便在检索时提供上下文。


#### Context-Enriched Chunking 上下文丰富分块

**工作原理** ：通过添加来自周围区块的摘要或元数据来丰富每个区块，保持序列间的上下文。

![上下文丰富块化——Visulization](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ezit462vInMvD0LvtxOdvw.png)

**最佳用途** ：长文档，许多部分之间必须保持一致。

**优势** ：

- 增强上下文 ：提供额外信息，同时不显著增加块大小。
- 提升一致性 ：帮助模型生成更准确、更符合上下文的回答。

**挑战** ：

- 复杂性 ：需要额外处理以生成摘要或元数据。
- 存储开销 ：丰富区块占用更多存储空间。

**实施建议** ：

- 生成简明总结，以减少额外的代币使用。
- 考虑将关键术语或概念作为元数据，而非完整摘要。


#### Modality-Specific Chunking 模态特定分块

**工作原理** ：分别处理不同类型的内容（文本、表格、图片），并根据其性质分块处理。

![特定模式分块——可视化](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8nnM5IZlz0whS1AaVLbHkQ.png)

**最佳用途** ：混合媒介文档，如科学论文或用户手册。

**优势** ：

- 量身定制方法 ：针对每种内容类型优化分块。
- 提高准确性 ：专业处理可以提升检索效果。

**挑战** ：

- 实现复杂性：需要为每种模态自定义逻辑。
- 整合困难 ：在检索过程中结合不同方式的信息可能具有挑战性。

**实施建议** ：

- 对包含文字的图片使用 OCR。
- 将表格转换为结构化数据格式。
- 保持不同模式间一致的索引系统。

#### Agentic Chunking  能动分块

**工作原理** ：采用大型语言模型（LLM）分析文本，并根据内容结构和语义建议区块边界。

![能动块——可视化](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*848wCkXIRYfKX8yI72xObQ.png)

**最佳用途** ：复杂文档，保留意义和上下文至关重要。

**优势** ：

- 智能细分 ：利用 LLM 的理解创建有意义的块。
- 适应性 ：能够有效处理多样化且无结构的内容。

**挑战** ：

- 计算密集型：处理整个文档需要大量资源。
- 成本 ：由于计算成本高昂，对于大规模应用可能不切实际。

**实施建议** ：

- 对于关键文件，选择性地使用代理分块。
- 优化 LLM 提示，使其专注于高效识别逻辑块边界。


#### Subdocument Chunking  子文档分块

**工作原理** ：总结整份文档或大段内容，并将这些摘要作为元数据附加到各个段落上。

![子文档分块——可视化](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NDSI5exKnvxJ7TVSaEi9wA.png)

**最佳用途** ：提升大量文档收藏的检索效率。

**优势** ：

- 分层检索 ：允许检索系统在多个上下文层级运行。
- 情境深度 ：为模型提供额外的信息层次。

**挑战** ：

- 额外处理 ：需要生成和管理摘要。
- 元数据管理 ：增加索引系统的复杂性。

**实施建议** ：

- 利用自然语言处理技术自动化摘要过程。
- 高效存储摘要以最大限度减少存储影响。


#### Hybrid Chunking  混合分块

**工作原理** ：结合多种分块策略，动态适应不同查询类型或文档结构。

![混合块化——可视化](https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HDXOPN2SkNvH8lRD53rI3Q.png)

**最佳用途** ：多功能系统，能够处理各种查询和文档类型。

**优势** ：

- 灵活性 ：可根据内容和需求调整策略。
- 优化性能 ：在不同用例间平衡速度与准确性。

**挑战** ：

- 复杂逻辑 ：需要复杂的决策算法。
- 维护： 更多组件会增加错误的可能性。

**实施建议** ：

- 制定选择分块策略的标准（例如文档类型、查询复杂度）。
- 广泛测试和验证混合方法以确保可靠性。
- 分块策略的比较分析
